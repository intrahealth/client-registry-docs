
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Technical documentation for the Client Registry" name="description"/>
<link href="https://github.com/intrahealth/client-registry-docs/installation_full/" rel="canonical"/>
<meta content="IntraHealth" name="author"/>
<meta content="Copy to clipboard" name="lang:clipboard.copy"/>
<meta content="Copied to clipboard" name="lang:clipboard.copied"/>
<meta content="en" name="lang:search.language"/>
<meta content="True" name="lang:search.pipeline.stopwords"/>
<meta content="True" name="lang:search.pipeline.trimmer"/>
<meta content="No matching documents" name="lang:search.result.none"/>
<meta content="1 matching document" name="lang:search.result.one"/>
<meta content="# matching documents" name="lang:search.result.other"/>
<meta content="[\s\-]+" name="lang:search.tokenizer"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.0.4, mkdocs-material-4.6.0" name="generator"/>
<title>Installation (Production) - Client Registry Documentation</title>
<link href="../assets/stylesheets/application.1b62728e.css" rel="stylesheet"/>
<link href="../assets/stylesheets/application-palette.a8b3c06d.css" rel="stylesheet"/>
<meta content="#546e7a" name="theme-color"/>
<script src="../assets/javascripts/modernizr.268332fc.js"></script>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
<link href="../assets/fonts/material-icons.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="blue-grey" dir="ltr">
<svg class="md-svg">
<defs>
<svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg"><path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor"></path></svg>
</defs>
</svg>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<a class="md-skip" href="#installation-production" tabindex="1">
        Skip to content
      </a>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a class="md-header-nav__button md-logo" href="https://github.com/intrahealth/client-registry-docs" title="Client Registry Documentation">
<i class="md-icon"></i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
              Client Registry Documentation
            </span>
<span class="md-header-nav__topic">
              
                Installation (Production)
              
            </span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-icon md-search__icon" for="__search"></label>
<button class="md-icon md-search__icon" data-md-component="reset" tabindex="-1" type="reset">
        
      </button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
            Type to start searching
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/intrahealth/client-registry-docs/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    intrahealth/client-registry-docs
  </div>
</a>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container">
<main class="md-main" role="main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="__drawer">
<a class="md-nav__button md-logo" href="https://github.com/intrahealth/client-registry-docs" title="Client Registry Documentation">
<i class="md-icon"></i>
</a>
    Client Registry Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/intrahealth/client-registry-docs/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    intrahealth/client-registry-docs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href=".." title="Overview">
      Overview
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gettingstarted/" title="Getting Started">
      Getting Started
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      User Manual
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-3">
        User Manual
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../workflow/" title="Workflows">
      Workflows
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decision_rules/" title="Decision Rules">
      Decision Rules
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../benchmarks/" title="Matching Benchmarks">
      Matching Benchmarks
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ui/" title="Admin Interface">
      Admin Interface
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dashboard/" title="Dashboard">
      Dashboard
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../resources/" title="Additional Resources">
      Additional Resources
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-toggle md-nav__toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Developer Manual
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-4">
        Developer Manual
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../security/" title="Security">
      Security
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../openmrs/" title="OpenMRS MPI Client">
      OpenMRS MPI Client
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docker/" title="Docker">
      Docker
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../installation/" title="Installation (Lite)">
      Installation (Lite)
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Installation (Production)
      </label>
<a class="md-nav__link md-nav__link--active" href="./" title="Installation (Production)">
      Installation (Production)
    </a>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#openhim">
    OpenHIM
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hapi-fhir-server">
    HAPI FHIR Server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#elasticsearch">
    ElasticSearch
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#client-registry-ui">
    Client Registry UI
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kibana-dashboard">
    Kibana Dashboard
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../queries/" title="Example API Query (cURL)">
      Example API Query (cURL)
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../queriespy/" title="Example API Query (Python)">
      Example API Query (Python)
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration/" title="Server Configuration">
      Server Configuration
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configurebenchmarks/" title="Configure Benchmarks">
      Configure Benchmarks
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../production/" title="Production Considerations">
      Production Considerations
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../backup/" title="Backup and Recovery">
      Backup and Recovery
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/" title="Troubleshooting">
      Troubleshooting
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/" title="Building Documentation">
      Building Documentation
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing/" title="Contributing">
      Contributing
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/" title="About">
      About
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#openhim">
    OpenHIM
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hapi-fhir-server">
    HAPI FHIR Server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#elasticsearch">
    ElasticSearch
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#client-registry-ui">
    Client Registry UI
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kibana-dashboard">
    Kibana Dashboard
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset"><a class="md-icon md-content__icon" download href="../pdf/combined.pdf" title="PDF Export"></a>
<a class="md-icon md-content__icon" href="https://github.com/intrahealth/client-registry-docs/edit/master/docs/installation_full.md" title="Edit this page"></a>
<h1 id="installation-production">Installation (Production)<a class="headerlink" href="#installation-production" title="Permanent link">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Installing and maintaining a production installation is not trivial. This installation method requires strong familiarity with the command line and expertise administering Linux environments. </p>
</div>
<p>The production stack consists of 10 components:</p>
<ul>
<li>OpenHIM core and OpenHIM admin console. Requires MongoDB and Nginx or another reverse proxy.</li>
<li>Client Registry Service as an OpenHIM mediator.</li>
<li>HAPI FHIR Server with a database backend.</li>
<li>ElasticSearch (&gt;=7.5)</li>
<li>Client Registry UI</li>
<li>Kibana Dashboard</li>
</ul>
<p>The expected operating system is Linux for production. Only Ubuntu versions have been tested.</p>
<p>It is critical that systems administrators note the version compatibilities outlined below. This guide does not cover most aspects of enterprise systems administration, rather it attempts to cover this Client Registry platform. If there are key areas missing, please open an <a href="https://github.com/intrahealth/client-registry/issues/new">issue on GitHub</a>.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2>
<ul>
<li>If entities outside of your LAN are connecting to the Client Registry, you will need a public-facing domain name. This is necessary for a certificate which is required for any interactions.</li>
<li>See <a href="">production considerations</a></li>
</ul>
<h2 id="openhim">OpenHIM<a class="headerlink" href="#openhim" title="Permanent link">¶</a></h2>
<p>OpenHIM supports the last 2 versions of NodeJS LTS and requires MongoDB.</p>
<ul>
<li>Follow the <a href="http://openhim.org/docs/installation/npm">instructions</a> to install OpenHIM core and admin console. The maintainers use the NPM PPA installation method.</li>
<li>Note the important step to obtain a certificate immediately after installation. The configuration should be that any client must have a certificate and the server has a certificate (mutual TLS).</li>
<li>Follow the instructions including console configuration. </li>
<li>Note the important step to change the console password. It is also recommended that the console only be accessible on a local subnet and not to the WAN.</li>
</ul>
<h2 id="hapi-fhir-server">HAPI FHIR Server<a class="headerlink" href="#hapi-fhir-server" title="Permanent link">¶</a></h2>
<p>HAPI FHIR should use a database backend in production. HAPI FHIR stores the patient demographic data from queries. If the data is lost, then the Client Registry is unrecoverable.</p>
<ul>
<li>Follow the <a href="https://hapifhir.io/hapi-fhir/docs/server_jpa/get_started.html">JPA Server information</a> and <a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter">instructions</a> for how to customize the hapi.properties file and build the server using maven.</li>
<li>The ES integration is separate from HAPI FHIR Server, so there is not need to use it as an indexer. ES only works with an old version of ES.</li>
<li>Install and configure the preferred database. Postgres has been tested by the maintainers but any database should work that HAPI supports. Change default passwords on the database.</li>
<li>Confirm that HAPI accepts requests. </li>
<li>The web interface for HAPI should be disabled for privacy reasons.</li>
</ul>
<p>!! In production, Postgres should run on multiple nodes, with one as the leader and others as followers. This is to ensure high availability and backups of the data.</p>
<h2 id="elasticsearch">ElasticSearch<a class="headerlink" href="#elasticsearch" title="Permanent link">¶</a></h2>
<ul>
<li>Follow the instructions for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html">installation</a></li>
<li>Systemd is the preferred system and service manager. There are commands to initiate systemd and journalctl.</li>
</ul>
<p>!! warning
    ES is not production-ready when run one a single node. It is recommended to run ES on several nodes. Those nodes can also run followers of Postgres.</p>
<h2 id="client-registry-ui">Client Registry UI<a class="headerlink" href="#client-registry-ui" title="Permanent link">¶</a></h2>
<p>Under construction.</p>
<h2 id="kibana-dashboard">Kibana Dashboard<a class="headerlink" href="#kibana-dashboard" title="Permanent link">¶</a></h2>
<p>Under construction.</p>
<hr/>
<div class="md-source-date">
<small>
                      
                        Last update: February 3, 2020
                      
                    </small>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="../installation/" rel="prev" title="Installation (Lite)">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Installation (Lite)
              </span>
</div>
</a>
<a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../queries/" rel="next" title="Example API Query (cURL)">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Example API Query (cURL)
              </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2020 IntraHealth International
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/application.808e90bb.js"></script>
<script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
</body>
</html>